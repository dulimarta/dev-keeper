<link rel="import" href="../bower_components/polymer/polymer.html">
<link href="../bower_components/vaadin-components/vaadin-grid/vaadin-grid.html" rel="import">
<dom-module id="user-list">
  <style>
    #usergrid .hans-class {
      background: #761234;
    }
  </style>
  <template>
    <div>Registered Users</div>
    <v-grid selection-mode="single" id="usergrid">
      <table>
        <colgroup>
          <col header-text="Photo">
          <col header-text="UserID">
          <col header-text="Name">
        </colgroup>
        <tbody>
        <template is="dom-repeat" items="{{users}}">
          <tr>
            <td><img src="{{item.userphotourl}}" width="64" height="64" /></td>
            <td><span>{{item.userid}}</span></td>
            <td><span>{{item.username}}</span></td>
          </tr>
        </template>
        </tbody>
      </table>
    </v-grid>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'user-list',
    properties : {
      users: Array
    },
    userLoaded: function(results) {
      this.users = [];
      for (var i = 0; i < results.length; i++) {
        var uObj = results[i];
        var photo = uObj.get('user_photo');
        if (typeof(photo) !== 'undefined') {
          this.push('users', {
            userid: uObj.get('user_id'),
            username: uObj.get('user_name'),
            userphotourl: photo.url()
          });
        }
        else {
          this.push('users', {
            userid: uObj.get('user_id'),
            username: uObj.get('user_name'),
            userphotourl: 'images/user.svg'
          });
        }
      }
      console.log ('After loop', this.users);
    },
    created: function() {
//      var grid = document.querySelector("v-grid");
//      grid.rowClassGenerator = function(row) {
//        return "hans-class";
//      }
    },
    ready:function() {
      var g = this.$.usergrid;
      g.rowClassGenerator = function(row) {
        return 'hans-class';
      };
      var UsersObj = Parse.Object.extend('Users');
      var query = new Parse.Query(UsersObj);
      query.find().done(this.userLoaded.bind(this),
        function(err) {
          console.log('Fail to load users', err);
        });
    }
  });
</script>
